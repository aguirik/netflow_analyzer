# Netflow analyzer
Простой коллектор Netflow с поддержкой подключаемых модулей анализа для обучающих целей.
 
## Модули анализа
После запуска коллектор создает слушающий сокет и получает пакеты Netflow, 
которые передает модулям анализа. Каталог с модулями анализа задается настройкой в
netflow_analyzer_config.py:
```python
    modules_directory = 'modules'
```
По умолчанию используется каталог 'modules' внутри основного каталога.

Требования к модулю анализа:
 - должен располагаться в отдельном каталоге
 - внутри каталога должен быть модуль `__init__.py`, содержащий функцию `get_module_object()`
 - внутри каталога должен быть файл `module.descr` в формате hjson
 
Функции `get_module_object()` передаются очередь сообщений, событие для сигнала об остановке работы и
описание модуля, прочитанное из файла `module.descr` (например, содержащее настройки для работы
модуля):
```python
    mo = mod.get_module_object(outq, stop_event, descr)
```
В файле `__init__.py` аргументы могут обрабатываться функцией `get_module_object()`, в простейшем случае
они просто передаются создаваемому экземпляру основного класса модуля анализа:
```python
def get_module_object(*args, **kwargs):
    return main.ExampleAnalysisModule(*args, **kwargs)
```

Объект, который возвращает функция `get_module_object()`, должен иметь метод `run()`, который и будет
запущен после загрузки модуля. Метод `run()` выполняется в отдельном процессе.

В общем случае внутри метода `run()` должен быть цикл, в котором из очереди выбираются сообщения с информацией о
потоках Netflow и выполняется анализ. Цикл должен завершаться, если основная программа перевела событие
остановки в установленное состояние.

В каталоге `modules` примеры модулей:
 - `example_analysis_module` - модуль, определяющий, какие tcp/udp порты чаще всего использовались 
 в обработанных пакетах
 - `simple_ddos_detector` - модуль, определяющий момент начала распределенной атаки на некоторый адрес